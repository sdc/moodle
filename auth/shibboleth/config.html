<?php
// Set default values
if (!isset($config->auth_instructions) or empty($config->shib_user_attribute)) {
    $config->auth_instructions = get_string('auth_shib_instructions', 'auth', $CFG->wwwroot.'/auth/shibboleth/shib-protected.php');
}

optional_variable($config->auth_shib_only,      0);
optional_variable($config->shib_user_attribute, '');
optional_variable($config->shib_logout_url,     '');
optional_variable($config->shib_convert_data,   0);

?>
<tr>
    <td colspan="3" align="left">
      <p>
        <?php  print_string("auth_shib_username_description", "auth") ?>
      </p>
    </td>
</tr>
<!--
<tr>
    <td align="right"><?php  print_string("auth_shib_only", "auth") ?>:</td>
    <td>
    <select name="auth_shib_only">
        <option value="0" <?php echo ($config->auth_shib_only ? '' : 'selected="yes"') ?> >
            <?php  print_string("no")  ?></option>
        <option value="1" <?php echo ($config->auth_shib_only ? 'selected="yes"' : '') ?> >
            <?php  print_string("yes") ?></option>
    </select>
    </td>
    <td><?php  print_string("auth_shib_only_description", "auth") ?></td>
    </td>
</tr>

<tr>
    <td align="right">Shibboleth logout url ():</td>
    <td>
    <input name="shib_logout_url" type="text" size="30" value="<?php echo $config->shib_logout_url?>">
    </td>
    <td></td>                                                                                                                                 </td>
</tr>
--> 
<tr valign="top" class="required">
    <td align="right"><?php  print_string("username") ?>:</td>
    <td>
    <input name="shib_user_attribute" type="text" size="30" value="<?php echo $config->shib_user_attribute?>">
    </td>
    <td></td>
    </td>
</tr>

<?php print_auth_lock_options($auth, $user_fields, '<!-- empty help -->', true, false);  ?>

<tr valign="top">
    <td align="right"><?php  print_string("instructions", "auth") ?>:</td>
    <td>
    <textarea name="auth_instructions" cols="30" rows="10" wrap="virtual"><?php  p($config->auth_instructions) ?></textarea> 
    </td>
    <td>
    <?php  print_string("auth_shib_instructions_help","auth", htmlspecialchars($CFG->wwwroot.'/auth/shibboleth')) ?>
    <?php  helpbutton("text", get_string("helptext")) ?>
    </td>
</tr>
<tr valign="top">
    <td align="right"><?php  print_string("auth_shib_convert_data", "auth") ?>:</td>
    <td>
    <input name="shib_convert_data" type="text" size="30" value="<?php echo $config->shib_convert_data?>"> 
    <? 
          if ($config->shib_convert_data && $config->shib_convert_data != '' && !is_readable($config->shib_convert_data)){
              echo '<br><font color="red">';
              print_string("auth_shib_convert_data_warning", "auth");
              echo '</font>';
          }
    ?>
    </td>
    <td><?php  print_string("auth_shib_convert_data_description", "auth") ?></td>
    </td>
</tr>
